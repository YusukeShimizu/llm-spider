---
title: Rust library
description: Use llm-spider as a library.
---

`llm-spider` is both a CLI and a Rust library.

## Dependency

This repository is not published to crates.io by default.
Use a path (or git) dependency.

```toml
[dependencies]
llm-spider = { path = "../llm-spider" }
```

## Environment

- `OPENAI_API_KEY` is required.
- Optional: `OPENAI_BASE_URL`, `LLM_SPIDER_OPENAI_*`.

| Variable | Default | Description |
|----------|---------|-------------|
| `LLM_SPIDER_OPENAI_SEARCH_MODEL` | `gpt-5.2` | Model for web search |
| `LLM_SPIDER_OPENAI_SELECT_MODEL` | `gpt-5.2` | Model for child link selection |
| `LLM_SPIDER_OPENAI_REASONING_EFFORT` | `medium` | Reasoning effort |

## Content extraction

Each crawled page is processed with `readability-rust` (Mozilla Readability
port) to extract the article body, then converted to Markdown with `htmd`.
The result is stored in `Source::content`.
If extraction fails, `content` falls back to the plain-text excerpt.

`compose_markdown()` outputs each page's full Markdown content.
When `max_chars > 0`, pages are included until adding the next page would
exceed the limit (page-boundary granularity; at least one page is always
included).

## Example

```rust
use std::time::Duration;

use anyhow::Context as _;
use llm_spider::openai::OpenAiClient;
use llm_spider::spider::{compose_markdown, crawl, UserRequest};

fn main() -> anyhow::Result<()> {
    llm_spider::logging::init().context("init logging")?;

    let request = UserRequest {
        query: "example query".to_owned(),
        max_chars: 4000,
        min_sources: 3,
        search_limit: 10,
        max_pages: 20,
        max_depth: 1,
        max_elapsed: Duration::from_secs(30),
        max_child_candidates: 20,
        max_children_per_page: 3,
        allow_local: false,
    };

    let openai = OpenAiClient::from_env().context("init OpenAI client")?;
    let result = crawl(&request, &openai).context("crawl")?;

    // Each source has `content` (full Markdown) and `excerpt` (plain text).
    for source in &result.sources {
        println!("URL: {}", source.url);
        println!("Trust: {:?}", source.trust_tier);
        println!("Content length: {} chars", source.content.len());
    }

    let markdown = compose_markdown(&request, &result);
    println!("{markdown}");
    Ok(())
}
```
